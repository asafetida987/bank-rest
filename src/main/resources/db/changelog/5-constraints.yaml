databaseChangeLog:
  - changeSet:
      id: 5
      author: maria
      preConditions:
        - not:
            uniqueConstraintExists:
              tableName: cards
              constraintName: uc_cards_cardnumber
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addUniqueConstraint:
            columnNames: card_number
            constraintName: uc_cards_cardnumber
            tableName: cards
  - changeSet:
      id: 6
      author: maria
      preConditions:
        - not:
            uniqueConstraintExists:
              tableName: refresh_tokens
              constraintName: uc_refresh_tokens_token
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addUniqueConstraint:
            columnNames: token
            constraintName: uc_refresh_tokens_token
            tableName: refresh_tokens
  - changeSet:
      id: 7
      author: maria
      preConditions:
        - not:
            uniqueConstraintExists:
              tableName: users
              constraintName: uc_users_login
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addUniqueConstraint:
            columnNames: login
            constraintName: uc_users_login
            tableName: users
  - changeSet:
      id: 8
      author: maria
      preConditions:
        - not:
            foreignKeyConstraintExists:
              tableName: cards
              constraintName: FK_CARDS_ON_BALANCE_CARD
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: balance_card_id
            baseTableName: cards
            constraintName: FK_CARDS_ON_BALANCE_CARD
            referencedColumnNames: card_id
            referencedTableName: card_balances
            onDelete: CASCADE
            onUpdate: CASCADE
  - changeSet:
      id: 9
      author: maria
      preConditions:
        - not:
            foreignKeyConstraintExists:
              tableName: cards
              constraintName: FK_CARDS_ON_OWNER
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: owner_id
            baseTableName: cards
            constraintName: FK_CARDS_ON_OWNER
            referencedColumnNames: id
            referencedTableName: users
            onDelete: CASCADE
            onUpdate: CASCADE
  - changeSet:
      id: 10
      author: maria
      preConditions:
        - not:
            foreignKeyConstraintExists:
              tableName: card_balances
              constraintName: FK_CARD_BALANCES_ON_CARD
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: card_id
            baseTableName: card_balances
            constraintName: FK_CARD_BALANCES_ON_CARD
            referencedColumnNames: id
            referencedTableName: cards
  - changeSet:
      id: 11
      author: maria
      preConditions:
        - not:
            foreignKeyConstraintExists:
              tableName: refresh_tokens
              constraintName: FK_REFRESH_TOKENS_ON_USER
              onFail: MARK_RAN
              onError: HALT
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: user_id
            baseTableName: refresh_tokens
            constraintName: FK_REFRESH_TOKENS_ON_USER
            referencedColumnNames: id
            referencedTableName: users
            onDelete: CASCADE
            onUpdate: CASCADE